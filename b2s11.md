# Taller Grupal 1: Programación Funcional Reactiva

**Semana:** 11  
**Asignatura:** Programación Funcional y Reactiva  

---

### Objetivos:
- Crear un `case class` en Scala para modelar datos específicos de un archivo CSV.
- Manipular colecciones de datos y realizar operaciones de filtrado y cálculos estadísticos.
- Aplicar fórmulas matemáticas (varianza) mediante el uso de funciones de agregación y procesamiento funcional.

> [!IMPORTANT]
> Resolver el siguiente problema en grupos según proyecto integrador (**solo estudiantes presentes en el aula**). El archivo a utilizar es: **`pi_movies_small.csv`**.

---

### Parte 1: Definición de case class y lectura de archivo

1. **Definición de la estructura:** Cree una `case class` llamada `Movie` que permita leer las siguientes columnas del archivo CSV: `adult`, `revenue`, `popularity`, `runtime` y `vote_average`.
2. **Tipado de datos:** Configure los atributos de la siguiente manera para asegurar un procesamiento correcto:
    - `adult`: `Boolean`
    - `revenue`: `Double`
    - `popularity`: `Double`
    - `runtime`: `Double`
    - `vote_average`: `Double`
3. **Implementación de lectura:** Utilizando la librería `fs2-data-csv` y el stack de `Cats Effect`, realice la lectura del archivo y convierta los datos en una lista de objetos de tipo `Movie`. Recuerde que el delimitador del archivo es punto y coma (`;`).

> **Entregable:** Código de la `case class` y el bloque de código funcional que realiza la lectura y carga de los datos.

---

### Parte 2: Análisis de datos

Utilizando la lista de objetos obtenida en la parte anterior, implemente la lógica para resolver los siguientes requerimientos:

1. **Filtrado por ingresos:** Obtenga y muestre una lista (o el conteo) de todas las películas cuyo `revenue` (ingresos) sea estrictamente mayor al promedio de ingresos de todo el conjunto de datos.
2. **Cálculo de la varianza:** Calcule la varianza de las calificaciones (`vote_average`) aplicando la siguiente fórmula:

$$
\sigma^2 = \frac{\sum_{i=1}^{n} (x_i - \overline{x})^2}{n}
$$

Donde:
- $x_i$: es el **vote_average** de cada película.
- $\overline{x}$: es el promedio de los **vote_average**.
- $n$: es el número total de películas procesadas.

> **Entregable:** Bloques de código donde se apliquen las funciones de orden superior (`filter`, `map`, `sum`) para resolver ambos puntos y capturas de pantalla de los resultados impresos en la consola.

## Solucion

```scala
package clasesBim2.semana11

import cats.effect.{IO, IOApp}
import fs2.text
import fs2.data.csv.*
import fs2.data.csv.generic.semiauto.*
import fs2.io.file.{Files, Path}

case class movie(
                  adult: Boolean,
                  revenue: Double,
                  popularity: Double,
                  runtime: Double,
                  vote_average: Double
                )

object GrupalMovies extends IOApp.Simple:
  val path = Path("src/main/resources/data/pi_movies_small.csv")

  given CsvRowDecoder[movie, String] = deriveCsvRowDecoder[movie]

  val run: IO[Unit] =
    Files[IO]
      .readAll(path)
      .through(text.utf8.decode)
      .through(decodeUsingHeaders[movie](';'))
      .compile
      .toList
      .flatMap { movies =>
        val totalMovies = movies.length
        val revenue = movies.map(_.revenue)
        val revenueAvg =
          if totalMovies == 0 then 0.0
          else movies.map(_.revenue).sum / totalMovies
        val filtradoReve = movies.filter(_.revenue > revenueAvg)
        val mejores = filtradoReve.take(5).map(m => f"${m.revenue}%.2f")
        val vote_average = movies.map(_.vote_average)
        val voteAvg =
          if totalMovies == 0 then 0.0
          else movies.map(_.vote_average).sum.toDouble / totalMovies
        val varianza = movies.map(m => math.pow(m.vote_average - voteAvg, 2)).sum / totalMovies

        IO.println(s"Promedio Ingresos $revenueAvg")>>
          IO.println(s"Películas con ingresos mayores al promedio: ${filtradoReve.size}. Ejemplos: ${mejores.mkString(", ")}")>>
          IO.println(s"Promedio vote_average: $voteAvg") >>
          IO.println(s"Varianza: $varianza")

      }


```

## Resultado

Promedio Ingresos 1.662521891919192E7
Películas con ingresos mayores al promedio: 6. Ejemplos: 169837010,00, 45284974,00, 847423452,00, 20117339,00, 519311965,00
Promedio vote_average: 5.434343434343434
Varianza: 5.62043669013366

---

### ✅ Calificación:

Una vez que termine debe presentar su trabajo a su docente.

- **10 puntos:** si presenta en el horario de prácticas y experimentación.
- **7 puntos:** si presenta en el horario de tutoría.

**La hora máxima de presentación será las 08h30.**
